{%- doc -%}
  Renders product badges for the product card.

  @param {object} product - The product object.
  @param {object} settings - The theme settings object.

  @example
  {% render 'product-card-badges', product: product, settings: settings %}
{%- enddoc -%}

<div
  class="product-badges product-badges--{{ settings.badge_position }}"
  style="
    --badge-padding-block: {{ settings.badge_padding_block }}px;
    --badge-padding-inline: {{ settings.badge_padding_inline }}px;
    --badge-padding-block-mobile: {{ settings.mobile_badge_padding_block }}px;
    --badge-padding-inline-mobile: {{ settings.mobile_badge_padding_inline }}px;
    --badge-border-radius: {{ settings.badge_corner_radius }}px;
    --badge-font-family: var(--font-{{ settings.badge_font_family }}--family);
    --badge-font-weight: {{ settings.badge_font_weight }};
    --badge-text-transform: {{ settings.badge_text_transform }};
    --badge-font-size: {{ settings.badge_font_size }}px;
    --badge-font-size-mobile: {{ settings.mobile_badge_font_size }}px;
    --badge-font-line-height: {{ settings.badge_font_line_height }}%;
    --badge-font-letter-spacing: {{ settings.badge_font_letter_spacing | divided_by: 100.0 }}em;
  "
>
  {%- if product.available == false or product.compare_at_price > product.price and product.available -%}
    <div
      class="
        product-badges__badge product-badges__badge--rectangle
        {% if product.available == false %} color-{{ settings.badge_sold_out_color_scheme }}{% elsif product.compare_at_price > product.price %} color-{{ settings.badge_sale_color_scheme }}{% endif %}
      "
    >
      {%- if product.available == false -%}
        {{ 'content.product_badge_sold_out' | t }}
      {%- elsif product.compare_at_price > product.price -%}
        {{ 'content.product_badge_sale' | t }}
      {%- endif -%}
    </div>
  {%- endif -%}
  {% if product.metafields.custom.tags != blank %}
    {% for tag in product.metafields.custom.tags.value %}
      <div class="product-badges__badge product-badges__badge--rectangle" style="background-color: {{ tag.bg_color }};color: {{ tag.text_color }};">
        {{ tag.label }}
        {% if tag.icon != blank %}
          <span class="product-badges__badge-icon">
            {{ tag.icon | image_url: width: 50 | image_tag }}
          </span>
        {% endif %}
      </div>
    {% endfor %}
  {% endif %}
</div>

{% stylesheet %}
  .product-badges {
    --badge-inset: max(var(--padding-xs), calc((var(--border-radius) + var(--padding-xs)) * (1 - cos(45deg))));

    position: absolute;
    z-index: var(--layer-flat);
    display: flex;
    flex-wrap: wrap;
    gap: var(--gap-3xs);
  }

  .product-badges--bottom-left {
    bottom: calc(var(--badge-inset) + var(--padding-block-start));
    left: calc(var(--badge-inset) + var(--padding-inline-start));
  }

  .product-badges--top-left {
    top: calc(var(--badge-inset) + var(--padding-block-start));
    left: calc(var(--badge-inset) + var(--padding-inline-start));
  }

  .product-badges--top-right {
    top: calc(var(--badge-inset) + var(--padding-block-start));
    right: calc(var(--badge-inset) + var(--padding-inline-start));
  }

  .product-badges__badge {
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    color: var(--color-foreground);
    background: var(--color-background);
    font-size: var(--badge-font-size);
    font-family: var(--badge-font-family);
    font-weight: var(--badge-font-weight);
    line-height: var(--badge-font-line-height);
    letter-spacing: var(--badge-font-letter-spacing);
    text-transform: var(--badge-text-transform);
    border-radius: var(--badge-border-radius);
    gap: var(--gap-3xs);
    padding-block: var(--badge-padding-block);
    padding-inline: var(--badge-padding-inline);
  }

  @media (max-width: 749px) {
    .product-badges__badge {
      font-size: var(--badge-font-size-mobile);
      padding-block: var(--badge-padding-block-mobile);
      padding-inline: var(--badge-padding-inline-mobile);
    }
  }

  .product-badges__badge-icon {
    display: flex;
    width: 16px;
  }
{% endstylesheet %}
