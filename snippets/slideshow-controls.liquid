{%- doc -%}
  Renders controls for a slider component

  @param {string} [style] - { 'dots' | 'counter' | 'thumbnails' | 'none' } The display style of the controls
  @param {boolean} [autoplay] - Whether the controls will display an autoplay option
  @param {number} [item_count] - The total number of slides
  @param {boolean} [show_arrows] - Whether the controls will display arrows
  @param {boolean} [arrows_on_media] - Whether the controls will display as floating icons on the media
  @param {boolean} [controls_on_media] - Whether the controls will display as floating controls on the media
  @param {media[]} [thumbnails] - Array of media to be displayed as thumbnails, sorted.
  @param {string} [pagination_position] - { 'left' | 'center' | 'right' } Sets the pagination position, defaults to 'center' if none passed
  @param {string} [icon_style] - The style of the icon, defaults to 'arrow'
  @param {string} [shape] - The shape of the control, defaults to 'square'
  @param {string} [aspect_ratio] - The aspect ratio of thumbnails, if applicable. defaults to 'adapt'
  @param {string} [class] - Additional classes to apply to the controls
  @param {boolean} [secondary] - Whether the controls are secondary

  @example
  {%- render 'slideshow-controls', style: 'dots', item_count: 10 -%}
{%- enddoc -%}

{%- liquid
  if aspect_ratio == null
    assign aspect_ratio = 'adapt'
  endif

  assign show_arrows_separately = false
  if style == 'thumbnails' and arrows_on_media == false
    assign show_arrows_separately = true
    # Specific case - we want to show the arrows with the thumbnails if everything is off media and centered.
    if controls_on_media == false and pagination_position == 'center'
      assign show_arrows_separately = false
    endif
  elsif controls_on_media == true and arrows_on_media == false
    assign show_arrows_separately = true
  endif

  if pagination_position == 'left' or pagination_position == 'right'
    assign scroll_mode = 'vertical'
  else
    assign scroll_mode = 'horizontal'
  endif

-%}

<slideshow-controls
  {% unless secondary %}
    ref="slideshowControls"
  {% endunless %}
  pagination-position="{{ pagination_position }}"
  scroll-mode="{{ scroll_mode }}"
  {% if controls_on_media %}
    controls-on-media
  {% endif %}
  {% if arrows_on_media or icon_style == 'none' %}
    icons-on-media
  {% endif %}
  {% if style == 'thumbnails' %}
    thumbnails
  {% endif %}
  {% if class %}
    class="{{ class }}"
  {% endif %}
  id="slideshow--controls--{{ block.id }}"
  style="--scroll-width: {{ scroll_width }}px; --scroll-width-mobile: {{ scroll_width_mobile }}px; --autoplay-speed : {{ autoplay_speed }}s;"
>
  {% if show_arrows_separately == false and show_arrows and pagination_position != 'left' %}
    <div class="slideshow-controls__arrows">
      {%- render 'slideshow-arrow', action: 'previous', icon_style: icon_style, icon_shape: shape -%}

      {% if pagination_position == 'right' %}
        {%- render 'slideshow-arrow', action: 'next', icon_style: icon_style, icon_shape: shape -%}
      {% endif %}
    </div>
  {% endif %}

  {% comment %}
    {% if autoplay %}
      <button
        type="button"
        class="slideshow-control button-secondary button-unstyled icon-pause"
        aria-label="{{ 'accessibility.slideshow_pause' | t }}"
        on:click="/pause"
      >
        {{- 'icon-pause.svg' | inline_asset_content -}}
      </button>
      <button
        type="button"
        class="slideshow-control button-secondary button-unstyled icon-play"
        aria-label="{{ 'accessibility.slideshow_play' | t }}"
        on:click="/play"
      >
        {{- 'icon-play.svg' | inline_asset_content -}}
      </button>
    {% endif %}
  {% endcomment %}

  {% case style %}
    {% when 'thumbnails' %}
      <scroll-hint
        ref="thumbnailsContainer"
        class="slideshow-controls__thumbnails-container"
      >
        <div class="slideshow-controls__thumbnails" style="width: 100%; padding-left: 0;padding-right: 0;">
          {% for media in thumbnails %}
            <button
              class="slideshow-control button button-unstyled slideshow-controls__thumbnail {% if forloop.first %} active {% endif %}"
              aria-label="{{ 'accessibility.slide_status' | t: index: forloop.index, length: forloop.length }}"
              on:click="/select/{{ forloop.index0 }}"
              style="--aspect-ratio: {% if aspect_ratio == 'adapt' %}{{ media.preview_image.aspect_ratio | default: 1.0 }}{% else %}{{ aspect_ratio }}{% endif %};"
              ref="thumbnails[]"
              {% if forloop.first %}
                aria-selected="true"
              {% endif %}
            >
              {% liquid
                assign focal_point_style = ''
                if media.presentation.focal_point != blank
                  assign focal_point_style = 'object-position: ' | append: media.presentation.focal_point | append: ';'
                endif
              %}
              {{
                media.preview_image
                | image_url: width: 144
                | image_tag: loading: 'lazy', alt: media.alt, style: focal_point_style
                | escape
              }}

              {% if media.media_type == 'video' or media.media_type == 'external_video' %}
                <span class="slideshow-controls__thumbnail-badge">
                  {{ 'icon-play.svg' | inline_asset_content }}
                </span>
              {% elsif media.media_type == 'model' %}
                <span class="slideshow-controls__thumbnail-badge">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    aria-hidden="true"
                    focusable="false"
                    class="icon icon-3d-model"
                    fill="none"
                    viewBox="0 0 18 21"
                  >
                    {% render 'icon', icon: '3d-model' %}
                  </svg>
                </span>
              {% endif %}
            </button>
          {% endfor %}
        </div>
      </scroll-hint>
    {% when 'counter' %}
      <div class="slideshow-controls__counter">
        <span ref="current">1</span><span class="slash">/</span>{{ item_count -}}
      </div>
    {% when 'dots' %}
      <ol class="slideshow-controls__{{ style }}">
        {% for i in (1..item_count) %}
          <li>
            <button
              class="slideshow-control button button-unstyled"
              style="animation-timeline: --slide-{{ forloop.index }}"
              aria-label="{{ 'accessibility.slide_status' | t: index: forloop.index, length: forloop.length }}"
              on:click="/select/{{ forloop.index0 }}"
              ref="dots[]"
              {% if forloop.first %}
                aria-selected="true"
              {% endif %}
            >
              {{ forloop.index }}
            </button>
          </li>
        {% endfor %}
      </ol>
    {% when 'scroll' %}
      <ol class="slideshow-controls__{{ style }} slideshow-controls__dots">
        {% for i in (1..item_count) %}
          <li>
            <button
              class="slideshow-control button button-unstyled"
              style="animation-timeline: --slide-{{ forloop.index }}"
              aria-label="{{ 'accessibility.slide_status' | t: index: forloop.index, length: forloop.length }}"
              on:click="/select/{{ forloop.index0 }}"
              ref="dots[]"
              {% if forloop.first %}
                aria-selected="true"
              {% endif %}
            >
              {{ forloop.index }}
            </button>
          </li>
        {% endfor %}
      </ol>
    {% when 'number' %}
      <ol class="slideshow-controls__{{ style }}">
        {% for i in (1..item_count) %}
          <li>
            <button
              class="slideshow-control button button-unstyled"
              style="animation-timeline: --slide-{{ forloop.index }}"
              aria-label="{{ 'accessibility.slide_status' | t: index: forloop.index, length: forloop.length }}"
              on:click="/select/{{ forloop.index0 }}"
              ref="dots[]"
              data-index="{{ forloop.index0 }}"
              {% if forloop.first %}
                aria-selected="true"
              {% endif %}
            >
              0{{ forloop.index }}
            </button>
          </li>
        {% endfor %}
      </ol>
  {% endcase %}
</slideshow-controls>

{% style %}
  slideshow-controls[pagination-position="top"] {
    top: 0;
    position: absolute;
    width: 100%;
  }

  {% if autoplay %}
    #slideshow--controls--{{ block.id }} .slideshow-controls__scroll.slideshow-controls__dots button[aria-selected="true"]:before {
      height: 100%;
      background: #fff;
      left: 0;
      position: absolute;
      opacity: 1;
      animation: fill var(--autoplay-speed) linear forwards;
      z-index: 2;
      display: block;
      content: '';
    }
  {% else %}
    #slideshow--controls--{{ block.id }} .slideshow-controls__scroll.slideshow-controls__dots button[aria-selected="true"]:before {
      width: var(--scroll-width);
      height: 100%;
      background: #fff;
      left: 0;
      position: absolute;
      opacity: 1;
      z-index: 2;
      display: block;
      content: '';
    }
  {% endif %}
 
  .slideshow-controls__thumbnails {
    {% if thumbnail_alignment == 'center' %}
      justify-content: center;
    {% elsif thumbnail_alignment == 'right' %}
      justify-content: flex-end;
    {% elsif thumbnail_alignment == 'space-between' %}
      justify-content: space-between;
    {% endif %}
  }

  @keyframes fill {
    from { width: 0%; }
    to   { width: 100%; }
  }
{% endstyle %}


{% stylesheet %}
.slideshow-controls__thumbnail.active {
  background-color: var(--color-primary-button-background);
  border: 0;
}
  .carousel-controls slideshow-controls[controls-on-media] {
    position: relative;
  }

  .product-information .slideshow-controls__number button[aria-selected='true'] {
    color: var(--color-primary-button-text);
  }

  .product-information .slideshow-controls__number button[aria-selected='false'] {
    color: var(--color-secondary-button-text);
  }

  .carousel-controls .slideshow-controls__number button[aria-selected='true'] {
    color: var(--color-primary-button-text);
  }

  .carousel-controls .slideshow-controls__number button[aria-selected='false'] {
    color: var(--color-secondary-button-text);
  }

  slideshow-controls:has(.slideshow-controls__dots),
  slideshow-component[autoplay] slideshow-controls {
    mix-blend-mode: unset !important;
  }

  .slideshow-controls__number li::marker {
    content: '' !important;
    display: none !important;
  }

  .slideshow-controls__number {
    list-style: none !important;
  }

  .slideshow-controls__number li::-webkit-details-marker {
    display: none !important;
  }

  .slideshow-controls__number {
    display: inline-flex;
    padding: 0;
    gap: 9px;
  }

  .slideshow-controls__scroll.slideshow-controls__dots {
    gap: 0;
  }
  .slideshow-controls__scroll.slideshow-controls__dots button {
    width: var(--scroll-width);
    margin: 0;
    --size: 2px;
    position: relative;
  }
  .slideshow-controls__scroll.slideshow-controls__dots button:after {
    width: var(--scroll-width);
    height: 100%;
    background: #fff;
    opacity: 0.3;
    left: 0;
    position: absolute;
  }

  @media screen and (max-width: 767px) {
    .product-information .desktop-pagination slideshow-controls.product-carousel--pagination {
      display: none;
    }

    .desktop-pagination slideshow-controls.custom-carousel--pagination {
      display: none;
    }

    .desktop-pagination slideshow-controls.product-carousel--pagination {
      display: none;
    }

    .both-pagination slideshow-controls.product-carousel--pagination,
    .mobile-pagination slideshow-controls.product-carousel--pagination {
      position: absolute;
      bottom: -8.4%;
      left: 50%;
      transform: translate(-50%);
    }

    .slideshow-controls__scroll.slideshow-controls__dots button {
      width: var(--scroll-width-mobile);
      margin: 0 1px;
    }
  }

  @media screen and (min-width: 768px) {
    .product-information .desktop-pagination slideshow-controls.product-carousel--pagination,
    .product-information .both-pagination slideshow-controls.product-carousel--pagination {
      position: absolute;
      bottom: -30%;
    }
    .product-information .mobile-pagination slideshow-controls.product-carousel--pagination {
      display: none;
    }

    .mobile-pagination slideshow-controls.custom-carousel--pagination {
      display: none;
    }

    slideshow-controls.slideshow-controls__scroll.custom-carousel--pagination {
      bottom: -3.2%;
      position: absolute;
      transform: translateX(-50%);
      left: 50%;
    }

    .mobile-pagination slideshow-controls.product-carousel--pagination {
      display: none;
    }

    .both-pagination slideshow-controls.product-carousel--pagination,
    .desktop-pagination slideshow-controls.product-carousel--pagination {
      position: absolute;
      bottom: -12%;
      left: 50%;
      transform: translate(-50%);
    }
  }
{% endstylesheet %}

<script>
  const buttons = document.querySelectorAll('.slideshow-controls__thumbnail');

  buttons.forEach(button => {
    button.addEventListener('click', () => {
      buttons.forEach(b => b.classList.remove('active'));
      button.classList.add('active');
    });
  });
</script>